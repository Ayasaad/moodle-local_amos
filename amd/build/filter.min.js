function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("local_amos/filter",["exports","core/utils","core/str","core/pubsub","./filter_events"],function(a,b,c,d,f){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;d=h(d);f=function(a){return a&&a.__esModule?a:{default:a}}(f);function g(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;g=function(){return a};return a}function h(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=g();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;if(f&&(f.get||f.set)){Object.defineProperty(c,e,f)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function i(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function j(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){i(h,d,e,f,g,"next",a)}function g(a){i(h,d,e,f,g,"throw",a)}f(void 0)})}}a.init=function init(){k();n();p();r();s()};var k=function(){var a=document.getElementById("amosfilter"),c=document.getElementById("amosfilter_fcmp"),g=document.getElementById("amosfilter_fcmp_search"),h=document.getElementById("amosfilter_flng"),i=document.getElementById("amosfilter_flng_search"),j=document.getElementById("amosfilter_fver"),k=document.getElementById("amosfilter_flast");a.addEventListener("click",function(b){if(!b.target.hasAttribute("data-action")){return}var e=b.target.getAttribute("data-action"),g=b.target.closest("[data-region]").getAttribute("data-region");if("amosfilter_fcmp"==g){l(b,c,e)}if("amosfilter_buttons"==g&&"togglemoreoptions"==e){q(b,a)}if("amosfilter_buttons"==g&&"submit"==e){b.preventDefault();b.target.blur();h.querySelectorAll(":scope option").forEach(function(a){a.removeAttribute("disabled")});var j=a.querySelector("form"),k=new FormData(j);o(i,h);k.delete("sesskey");d.publish(f.default.submit,new URLSearchParams(k).toString())}});a.addEventListener("change",function(a){if(a.target.id.startsWith("amosfilter_fcmp_")){n()}if("amosfilter_flng"==a.target.id){p()}if("amosfilter_flast"==a.target.id){if(k.checked){j.setAttribute("disabled","disabled")}else{j.removeAttribute("disabled")}}});[g,i].forEach(function(a){a.addEventListener("keypress",function(a){if(13==a.keyCode){a.preventDefault();a.stopPropagation()}})});g.addEventListener("input",(0,b.debounce)(function(a){m(a,g,c)},200));i.addEventListener("input",(0,b.debounce)(function(){o(i,h)},200))},l=function(a,b,c){if("selectstandard"==c){a.preventDefault();var d=function(a){return"".concat(":scope [data-region=\"amosfilter_fcmp_item\"]:not(.hidden) input[name=\"fcmp[]\"]","[data-component-type=\"").concat(a,"\"]")};b.querySelectorAll("".concat(d("core"),", ").concat(d("standard"))).forEach(function(a){a.checked=!0})}if("selectapp"==c){a.preventDefault();b.querySelectorAll("".concat(":scope [data-region=\"amosfilter_fcmp_item\"]:not(.hidden) input[name=\"fcmp[]\"]","[data-component-app]")).forEach(function(a){a.checked=!0})}if("selectall"==c){a.preventDefault();b.querySelectorAll("".concat(":scope [data-region=\"amosfilter_fcmp_item\"]:not(.hidden) input[name=\"fcmp[]\"]")).forEach(function(a){a.checked=!0})}if("selectnone"==c){a.preventDefault();b.querySelectorAll("".concat(":scope [data-region=\"amosfilter_fcmp_item\"]:not(.hidden) input[name=\"fcmp[]\"]")).forEach(function(a){a.checked=!1})}n()},m=function(a,b,c){var d=b.value.toString().replace(/^ +| +$/,"").toLowerCase();c.querySelectorAll(":scope label[for^=\"amosfilter_fcmp_f_\"]").forEach(function(a){var b=a.closest("[data-region=\"amosfilter_fcmp_item\"]");if(""==d||-1!==a.innerText.toString().toLowerCase().indexOf(d)){b.classList.remove("hidden")}else{b.classList.add("hidden")}})},n=function(){var a=document.getElementById("amosfilter_fcmp"),b=document.getElementById("amosfilter_fcmp_counter"),c=document.getElementById("amosfilter_fcmp_invalid_feedback"),d=a.querySelectorAll(":scope input[name=\"fcmp[]\"]:checked").length;if(0==d){b.classList.add("badge-danger");a.classList.add("is-invalid");c.classList.remove("hidden")}else{b.classList.remove("badge-danger");a.classList.remove("is-invalid");c.classList.add("hidden")}b.textContent=d},o=function(a,b){var c=a.value.toString().replace(/^ +| +$/,"").toLowerCase();b.querySelectorAll(":scope option").forEach(function(a){if(""==c||-1!==a.text.toString().toLowerCase().indexOf(c)){a.classList.remove("hidden");a.removeAttribute("disabled")}else{a.classList.add("hidden");a.setAttribute("disabled","disabled")}})},p=function(){var a=document.getElementById("amosfilter_flng"),b=document.getElementById("amosfilter_flng_counter"),c=document.getElementById("amosfilter_flng_invalid_feedback"),d=a.querySelectorAll(":scope option:checked").length;if(0==d){b.classList.add("badge-danger");a.classList.add("is-invalid");c.classList.remove("hidden")}else{b.classList.remove("badge-danger");a.classList.remove("is-invalid");c.classList.add("hidden")}b.textContent=d},q=function(){var a=j(regeneratorRuntime.mark(function a(b,d){return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:b.preventDefault();if(!("0"==d.getAttribute("data-level-showadvanced"))){a.next=8;break}d.setAttribute("data-level-showadvanced",1);a.next=5;return(0,c.get_string)("lessfilteringoptions","local_amos");case 5:b.target.innerText=a.sent;a.next=13;break;case 8:d.setAttribute("data-level-showadvanced",0);a.next=11;return(0,c.get_string)("morefilteringoptions","local_amos");case 11:b.target.innerText=a.sent;r();case 13:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}(),r=function(){var a=document.getElementById("amosfilter");a.querySelectorAll(":scope [data-level=\"advanced\"][data-level-control]").forEach(function(a){var b=document.getElementById(a.getAttribute("data-level-control")),c=!1;if("input"==b.tagName.toLowerCase()&&"checkbox"==b.getAttribute("type")&&b.checked){c=!0}if("input"==b.tagName.toLowerCase()&&"text"==b.getAttribute("type")&&""!==b.value){c=!0}if("select"==b.tagName.toLowerCase()&&b.hasAttribute("data-default")&&!b.hasAttribute("disabled")){var d=b.querySelectorAll(":scope option:checked");if(1!=d.length){c=!0}else{d.forEach(function(a){if(a.value!==b.getAttribute("data-default")){c=!0}})}}if(c){a.setAttribute("data-level-forceshow",1)}else{a.removeAttribute("data-level-forceshow")}});a.querySelectorAll(":scope [data-level=\"advanced\"][data-level-control]").forEach(function(a){var b=document.getElementById(a.getAttribute("data-level-control"));if("fieldset"==b.tagName.toLowerCase()){if(b.querySelector("[data-level-forceshow]")){a.setAttribute("data-level-forceshow",1)}else{a.removeAttribute("data-level-forceshow")}}})},s=function(){var a=document.getElementById("amosfilter_fcmp").querySelector("input[id^=\"amosfilter_fcmp_f_\"]:checked");if(a){a.scrollIntoView(!1)}}});
//# sourceMappingURL=filter.min.js.map
