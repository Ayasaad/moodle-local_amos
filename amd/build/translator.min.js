function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("local_amos/translator",["exports","core/ajax","core/config","core/notification","core/pubsub","./filter_events","./translator_events","core/templates"],function(a,b,c,d,f,g,h,i){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;c=l(c);d=l(d);f=k(f);g=l(g);h=l(h);i=l(i);function j(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;j=function(){return a};return a}function k(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=j();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;if(f&&(f.get||f.set)){Object.defineProperty(c,e,f)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function l(a){return a&&a.__esModule?a:{default:a}}var m=function(){n();r();f.subscribe(g.default.submit,function(a){s(a)})};a.init=m;var n=function(){var a=document.getElementById("amostranslator");a.addEventListener("click",function(a){if(a.target.classList.contains("amostranslation")||a.target.classList.contains("amostranslationview")){var c=a.target.closest("[data-region=\"amostranslatoritem\"]");if("view"==c.getAttribute("data-mode")){o(c,a.ctrlKey).focus()}}var b=a.target.closest("[data-paginatorlink]");window.console.log(b);if(b){a.preventDefault();f.publish(h.default.pagechange,b.getAttribute("data-paginatorlink"))}});a.addEventListener("blur",function(a){if(a.target.hasAttribute("data-region")&&"amoseditor"==a.target.getAttribute("data-region")){p(a.target)}},!0)},o=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1,c=a.querySelector("[data-region=\"amoseditor\"]"),d=a.querySelector(".amostranslation").clientHeight;a.setAttribute("data-nocleaning",b?"1":"0");c.setAttribute("data-previous",c.value);if(40<d){c.style.height=d-9+"px"}a.setAttribute("data-mode","edit");return c},p=function(a){var b=a.closest("[data-region=\"amostranslatoritem\"]"),c=b.getAttribute("data-nocleaning"),e=a.getAttribute("data-previous"),f=a.value;if("1"===c){f=f.trim()}if(e===f&&"1"!==c){a.value=e;b.setAttribute("data-mode","view");return Promise.resolve(!1)}else{b.classList.add("staged");a.disabled=!0;return q(b,f).then(function(c){b.setAttribute("data-mode","view");a.disabled=!1;a.removeAttribute("data-previous");a.innerHTML=a.value=c.translation;b.querySelector("[data-region=\"amostranslationview\"]").innerHTML=c.displaytranslation;b.querySelector("[data-region=\"displaytranslationsince\"]").innerHTML=c.displaytranslationsince+" | ";return!0}).catch(d.default.exception)}},q=function(a,d){return(0,b.call)([{methodname:"local_amos_stage_translated_string",args:{stageid:c.default.sesskey,originalid:a.getAttribute("data-originalid"),lang:a.getAttribute("data-language"),text:d,translationid:parseInt(a.getAttribute("data-translationid"))||0,nocleaning:a.getAttribute("data-nocleaning")}}])[0]},r=function(){var a=document.getElementById("amostranslator"),b=a.querySelectorAll(":scope [data-region=\"amostranslatoritem\"].missing");b.forEach(o)},s=function(a){var c=document.getElementById("amostranslator");c.classList.add("loading");return(0,b.call)([{methodname:"local_amos_get_translator_data",args:{filterquery:a}}])[0].then(function(a){try{var b=JSON.parse(a.json);return i.default.render("local_amos/translator_root",b)}catch(a){return Promise.reject(a)}}).then(function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"";return i.default.replaceNodeContents(c,a,b)}).then(function(){r();c.classList.remove("loading");return!0}).catch(d.default.exception)}});
//# sourceMappingURL=translator.min.js.map
