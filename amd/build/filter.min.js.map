{"version":3,"sources":["../src/filter.js"],"names":["SELECTORS","ROOT","ID","REGION","FCMP","FCMPITEM","FCMPCOUNTER","FCMPSEARCH","FLNG","FLNGCOUNTER","FLNGSEARCH","FVER","FLAST","init","registerEventListeners","updateCounterOfSelectedComponents","updateCounterOfSelectedLanguages","root","document","getElementById","fcmp","componentSearch","flng","languageSearch","fver","flast","addEventListener","e","target","hasAttribute","action","getAttribute","region","closest","handleComponentSelectorAction","startsWith","checked","classList","add","remove","forEach","inputField","keyCode","preventDefault","stopPropagation","handleComponentSearch","handleLanguageSearch","selectorComponentItem","selectorByType","type","querySelectorAll","item","needle","value","toString","replace","toLowerCase","row","innerText","indexOf","counter","count","length","textContent","text","removeAttribute","setAttribute"],"mappings":"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","sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * JS module for the AMOS translator filter.\n *\n * @module      local_amos/filter\n * @package     local_amos\n * @copyright   2020 David Mudr√°k <david@moodle.com>\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {debounce} from 'core/utils';\n\nconst SELECTORS = {\n    ROOT: {\n        ID: 'amosfilter',\n        REGION: 'amosfilter',\n    },\n    FCMP: {\n        ID: 'amosfilter_fcmp',\n        REGION: 'amosfilter_fcmp',\n    },\n    FCMPITEM: {\n        REGION: 'amosfilter_fcmp_item',\n    },\n    FCMPCOUNTER: {\n        ID: 'amosfilter_fcmp_counter',\n    },\n    FCMPSEARCH: {\n        ID: 'amosfilter_fcmp_search',\n    },\n    FLNG: {\n        ID: 'amosfilter_flng',\n        REGION: 'amosfilter_flng',\n    },\n    FLNGCOUNTER: {\n        ID: 'amosfilter_flng_counter',\n    },\n    FLNGSEARCH: {\n        ID: 'amosfilter_flng_search',\n    },\n    FVER: {\n        ID: 'amosfilter_fver',\n    },\n    FLAST: {\n        ID: 'amosfilter_flast',\n    },\n};\n\n/**\n * Initialise the module and register events handlers.\n *\n * @function init\n */\nexport const init = () => {\n    registerEventListeners();\n    updateCounterOfSelectedComponents();\n    updateCounterOfSelectedLanguages();\n};\n\n/**\n * @function registerEventListeners\n * @param {Element} root\n */\nconst registerEventListeners = () => {\n    let root = document.getElementById(SELECTORS.ROOT.ID);\n    let fcmp = document.getElementById(SELECTORS.FCMP.ID);\n    let componentSearch = document.getElementById(SELECTORS.FCMPSEARCH.ID);\n    let flng = document.getElementById(SELECTORS.FLNG.ID);\n    let languageSearch = document.getElementById(SELECTORS.FLNGSEARCH.ID);\n    let fver = document.getElementById(SELECTORS.FVER.ID);\n    let flast = document.getElementById(SELECTORS.FLAST.ID);\n\n    // Click event delegation.\n    root.addEventListener('click', e => {\n        if (!e.target.hasAttribute('data-action')) {\n            return;\n        }\n\n        let action = e.target.getAttribute('data-action');\n        let region = e.target.closest('[data-region]').getAttribute('data-region');\n\n        if (region == SELECTORS.FCMP.REGION) {\n            handleComponentSelectorAction(e, fcmp, action);\n        }\n    });\n\n    // Input change event delegation.\n    root.addEventListener('change', e => {\n        if (e.target.getAttribute('id').startsWith('amosfilter_fcmp_')) {\n            updateCounterOfSelectedComponents();\n        }\n\n        if (e.target.getAttribute('id') == SELECTORS.FLNG.ID) {\n            updateCounterOfSelectedLanguages();\n        }\n\n        if (e.target.getAttribute('id') == SELECTORS.FLAST.ID) {\n            if (flast.checked) {\n                fver.classList.add('hidden');\n            } else {\n                fver.classList.remove('hidden');\n            }\n        }\n    });\n\n    // Prevent form submission on pressing Enter in the component search and language input.\n    [componentSearch, languageSearch].forEach(inputField => {\n        inputField.addEventListener('keypress', e => {\n            if (e.keyCode == 13) {\n                e.preventDefault();\n                e.stopPropagation();\n            }\n        });\n    });\n\n    // Handle component search.\n    componentSearch.addEventListener('input', debounce(e => {\n        handleComponentSearch(e, componentSearch, fcmp);\n    }, 200));\n\n    // Handle language search.\n    languageSearch.addEventListener('input', debounce(e => {\n        handleLanguageSearch(e, languageSearch, flng);\n    }, 200));\n};\n\n/**\n * @function handleComponentSelectorAction\n * @param {Event} e\n * @param {Element} fcmp\n * @param {string} action\n */\nconst handleComponentSelectorAction = (e, fcmp, action) => {\n\n    let selectorComponentItem = `:scope [data-region=\"${SELECTORS.FCMPITEM.REGION}\"]:not(.hidden) input[name=\"fcmp[]\"]`;\n\n    if (action == 'selectstandard') {\n        e.preventDefault();\n        let selectorByType = type => `${selectorComponentItem}[data-component-type=\"${type}\"]`;\n        fcmp.querySelectorAll(`${selectorByType('core')}, ${selectorByType('standard')}`).forEach(item => {\n            item.checked = true;\n        });\n    }\n\n    if (action == 'selectapp') {\n        e.preventDefault();\n        fcmp.querySelectorAll(`${selectorComponentItem}[data-component-app]`).forEach(item => {\n            item.checked = true;\n        });\n    }\n\n    if (action == 'selectall') {\n        e.preventDefault();\n        fcmp.querySelectorAll(`${selectorComponentItem}`).forEach(item => {\n            item.checked = true;\n        });\n    }\n\n    if (action == 'selectnone') {\n        e.preventDefault();\n        fcmp.querySelectorAll(`${selectorComponentItem}`).forEach(item => {\n            item.checked = false;\n        });\n    }\n\n    updateCounterOfSelectedComponents();\n};\n\n/**\n * @function handleComponentSearch\n * @param {Event} e\n * @param {Element} inputField\n * @param {Element} fcmp\n */\nconst handleComponentSearch = (e, inputField, fcmp) => {\n    let needle = inputField.value.toString().replace(/^ +| +$/, '').toLowerCase();\n\n    fcmp.querySelectorAll(':scope label[for^=\"amosfilter_fcmp_f_\"]').forEach(item => {\n        let row = item.closest('[data-region=\"amosfilter_fcmp_item\"]');\n        if (needle == '' || item.innerText.toString().toLowerCase().indexOf(needle) !== -1) {\n            row.classList.remove('hidden');\n        } else {\n            row.classList.add('hidden');\n        }\n    });\n};\n\n/**\n * @function updateCounterOfSelectedComponents\n */\nconst updateCounterOfSelectedComponents = () => {\n    let fcmp = document.getElementById(SELECTORS.FCMP.ID);\n    let counter = document.getElementById(SELECTORS.FCMPCOUNTER.ID);\n    let count = fcmp.querySelectorAll(':scope input[name=\"fcmp[]\"]:checked').length;\n\n    if (count == 0) {\n        counter.classList.add('badge-danger');\n    } else {\n        counter.classList.remove('badge-danger');\n    }\n\n    counter.textContent = count;\n};\n\n/**\n * @function handleLanguageSearch\n * @param {Event} e\n * @param {Element} inputField\n * @param {Element} flng\n */\nconst handleLanguageSearch = (e, inputField, flng) => {\n    let needle = inputField.value.toString().replace(/^ +| +$/, '').toLowerCase();\n\n    flng.querySelectorAll(':scope option').forEach(item => {\n        if (needle == '' || item.text.toString().toLowerCase().indexOf(needle) !== -1) {\n            item.classList.remove('hidden');\n            item.removeAttribute('disabled');\n        } else {\n            item.classList.add('hidden');\n            item.setAttribute('disabled', 'disabled');\n        }\n    });\n};\n\n/**\n * @function updateCounterOfSelectedLanguages\n */\nconst updateCounterOfSelectedLanguages = () => {\n    let flng = document.getElementById(SELECTORS.FLNG.ID);\n    let counter = document.getElementById(SELECTORS.FLNGCOUNTER.ID);\n    let count = flng.querySelectorAll(':scope option:checked').length;\n\n    if (count == 0) {\n        counter.classList.add('badge-danger');\n    } else {\n        counter.classList.remove('badge-danger');\n    }\n\n    counter.textContent = count;\n};\n\n"],"file":"filter.min.js"}